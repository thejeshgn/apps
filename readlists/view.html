<html>
<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/jumbotron-narrow.css">

<title>Readlists</title>
</head>
<body>
 
    <div class="container">
      <div class="header">
        <ul class="nav nav-pills pull-right" role="tablist">
          <li role="presentation"><a href="https://apps.thejeshgn.com/readlists/">Home</a></li>
          <li role="presentation"><a href="https://thejeshgn.com/tag/readlists/">About</a></li>
        </ul>
        <h3 id="headline" class="text-muted">Readlists</h3>
      </div>

      <div id="description" class="alert alert-info">
        
      </div>
      
      <div id="news_scroll" class="col-lg-12">

      </div>

      <div class="row marketing">
        <div class="col-lg-12">
        </div>
      </div>
      <footer class="footer">
        <a href="http://thejeshgn.com">Thejesh GN</a> 2022
      </footer>

    </div> <!-- /container -->

<script>
let rendered_items = []
let readlist = getParameter()
const url = 'https://data.thejeshgn.com/readlists/'+readlist;

function getParameter() {
    let urlString = window.location.href;
    let paramString = urlString.split('?')[1];
    let queryString = new URLSearchParams(paramString);
    for(let pair of queryString.entries()) {
        if (pair[0] == "readlist"){
          return pair[1];
        }
    }
    return "paul-miller-offline.json";
}

function renderItem(val){
  domainFavIconURL ='https://www.google.com/s2/favicons?domain='+val.external_url;
  let item_content =  "<div class='list-group-item'>"
  item_content = item_content + "<div class='news_item_header'>"
  item_content = item_content + "<img  class='news_item_favicon' src='"+domainFavIconURL+"' width=16 height=16/>"
  item_content = item_content + "<a href='"+val.external_url+"' target='_blank'>" + val.title + "</a>"
  item_content = item_content + "</div>"
  item_content = item_content + "<p><i>"+val.author['name']+"</i></p><p class='news_item_description'>"+val.summary+"</p>"
  item_content = item_content + "</div>"

  rendered_items.push(item_content)
}

function renderFeed(data){
  document.querySelector("#headline").innerHTML = data.title;
  description = "" //"<p>"+data.title+"</p>"
  description = description + "<p><i>Readlist by:</i> "+ data.author['name'] +"</p>"
  description = description + "<p>"+data.description+"</p>"
  description = description + "<br/><br/><p> This readlist is availabe as <a href='"+url+"'><img width='16px' src='img/jsonfeed.png'>JSONFeed</a> for you to import into your favorite reader.</p>";

  document.querySelector("#description").innerHTML = description;

  data.items.forEach(renderItem);
  let listgroup = document.createElement("div");
  listgroup.class = "list-group";
  listgroup.innerHTML = rendered_items.join( "" );
  document.querySelector("#news_scroll").appendChild(listgroup);
  
}

async function displayFeedJSON(url){
  const data = await fetch(url)
    .then(function(response) {
        if (!response.ok) {
          console.log("Response not okay");
          throw new Error('HTTP error, status = ' + response.status);
        }        
        return response.json();
      })
      .then(function(data) {
        renderFeed(data);
      })
      .catch(function(error) {
        //we can catch and do something
        return null;
      });
}


displayFeedJSON(url);

</script>
    
</body>
</html>
